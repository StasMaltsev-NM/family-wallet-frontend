
    // ============================
    // –ú–ê–ì–ê–ó–ò–ù –ù–ê–ì–†–ê–î
    // ============================

    function toggleAddRewardForm() {
      const form = document.getElementById('addRewardForm');
      form.style.display = form.style.display === 'block' ? 'none' : 'block';
      if (form.style.display === 'block') {
        document.getElementById('rewardTitle').value = '';
        document.getElementById('rewardDescription').value = '';
        document.getElementById('rewardPrice').value = '';
        document.getElementById('rewardIsPermanent').checked = false;
      }
    }

    async function loadRewards() {
      try {
        const res = await fetch(`${API_URL}/api/rewards/list`, {
          headers: { 'X-Invite-Code': currentCode }
        });
        const data = await res.json();
        if (!Array.isArray(data.rewards)) {
          document.getElementById('rewardsList').innerHTML = '<p class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞–≥—Ä–∞–¥</p>';
          return;
        }
        const rewardsList = document.getElementById('rewardsList');
        if (data.rewards.length === 0) {
          rewardsList.innerHTML = '<div class="empty-state">–ù–∞–≥—Ä–∞–¥ –ø–æ–∫–∞ –Ω–µ—Ç. –ù–∞–∂–º–∏—Ç–µ \'+\' —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å.</div>';
          return;
        }
        rewardsList.innerHTML = data.rewards.map(reward => `
          <div class="task-item" style="position: relative;">
            <button class="delete-button" onclick="deleteReward('${reward.id}')">‚úï</button>
            <div style="display: flex; align-items: center; gap: 10px;">
              <span style="font-size: 32px;">${reward.icon || 'üéÅ'}</span>
              <div style="flex: 1;">
                <strong>${reward.title}</strong>
                <div style="font-size: 14px; color: #666;">${reward.description || ''}</div>
                <div style="margin-top: 5px;">
                  <span style="font-weight: bold; color: #4CAF50;">${reward.price} ‚≠ê</span>
                  ${reward.is_permanent ? '<span style="margin-left: 10px; font-size: 12px; color: #999;">üìå –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π</span>' : '<span style="margin-left: 10px; font-size: 12px; color: #999;">üîÑ –†–∞–∑–æ–≤—ã–π</span>'}
                </div>
              </div>
            </div>
          </div>
        `).join('');
      } catch (err) {
        document.getElementById('rewardsList').innerHTML = `<p class="error">–û—à–∏–±–∫–∞: ${err.message}</p>`;
      }
    }

    async function createReward() {
      const title = document.getElementById('rewardTitle').value.trim();
      const description = document.getElementById('rewardDescription').value.trim();
      const price = parseInt(document.getElementById('rewardPrice').value);
      const isPermanent = document.getElementById('rewardIsPermanent').checked;
      if (!title) {
        alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞–≥—Ä–∞–¥—ã');
        return;
      }
      if (!price || price < 1 || price > 10000) {
        alert('–¶–µ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 1 –¥–æ 10000');
        return;
      }
      try {
        const res = await fetch(`${API_URL}/api/rewards/create`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-Invite-Code': currentCode
          },
          body: JSON.stringify({ title, description, price, is_permanent: isPermanent })
        });
        const data = await res.json();
        if (data.error) {
          alert('–û—à–∏–±–∫–∞: ' + data.error);
          return;
        }
        toggleAddRewardForm();
        loadRewards();
      } catch (err) {
        alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–∞–≥—Ä–∞–¥—ã: ' + err.message);
      }
    }

    async function deleteReward(rewardId) {
      if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –Ω–∞–≥—Ä–∞–¥—É?')) return;
      try {
        const res = await fetch(`${API_URL}/api/rewards/delete`, {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json',
            'X-Invite-Code': currentCode
          },
          body: JSON.stringify({ reward_id: rewardId })
        });
        const data = await res.json();
        if (data.error) {
          alert('–û—à–∏–±–∫–∞: ' + data.error);
          return;
        }
        loadRewards();
      } catch (err) {
        alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –Ω–∞–≥—Ä–∞–¥—ã: ' + err.message);
      }
    }
